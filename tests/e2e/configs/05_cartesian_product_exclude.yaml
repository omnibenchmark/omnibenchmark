id: CartesianProductExcludeBenchmark
description: Cartesian product pipeline demonstrating exclude functionality - 3 datasets with 2 methods where D2 excludes certain method combinations
version: "1.0"
benchmarker: "E2E Test Suite"
benchmark_yaml_spec: "0.3"
# api_version: "0.3.0"
software_backend: host

software_environments:
  host:
    description: "Host environment for direct execution"

stages:
  - id: data
    modules:
      - id: D1
        name: "Dataset 1 - Generate test values"
        software_environment: "host"
        repository:
          url: bundles/dummymodule_4ff8427.bundle
          commit: 4ff8427
        parameters:
          - values: ["--evaluate", "100"]

      - id: D2
        name: "Dataset 2 - Generate test values with exclusions"
        software_environment: "host"
        repository:
          url: bundles/dummymodule_4ff8427.bundle
          commit: 4ff8427
        parameters:
          - values: ["--evaluate", "200"]
        exclude: ["M2"]

      - id: D3
        name: "Dataset 3 - Generate test values"
        software_environment: "host"
        repository:
          url: bundles/dummymodule_4ff8427.bundle
          commit: 4ff8427
        parameters:
          - values: ["--evaluate", "300"]
    outputs:
      - id: data.raw
        path: "{dataset}_data.json"

  - id: methods
    modules:
      - id: M1
        name: "Method 1 - Process all datasets"
        software_environment: "host"
        repository:
          url: bundles/dummymodule_4ff8427.bundle
          commit: 4ff8427
        parameters:
          - values: ["--evaluate", "input+1000", "--input", "data.raw", "--kind", "method"]

      - id: M2
        name: "Method 2 - Process datasets (excluded by D2)"
        software_environment: "host"
        repository:
          url: bundles/dummymodule_4ff8427.bundle
          commit: 4ff8427
        parameters:
          - values: ["--evaluate", "input+2000", "--input", "data.raw", "--kind", "method"]
    inputs:
      - entries:
          - data.raw
    outputs:
      - id: methods.result
        path: "{dataset}_method.json"

metric_collectors:
  - id: MC1
    name: "Gather and calculate metrics from all method results"
    software_environment: "host"
    repository:
      url: bundles/dummycollector_9e3a99a.bundle
      commit: 9e3a99a
    inputs:
      - methods.result
    outputs:
      - id: metrics.summary
        path: "{input}/metrics/metrics.json"
